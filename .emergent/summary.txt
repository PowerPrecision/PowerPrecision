<analysis>**original_problem_statement:**
The user initially requested a feature for **AI-powered document categorization and search**. After this was implemented, the user provided two new sets of requirements:
1.  **Automatic Categorization:** Enhance the recently built feature so that AI categorization happens automatically upon document upload, instead of requiring a manual button click.
2.  **AI-Powered Document Expiry Watchdog:** Implement a comprehensive system to ensure the AI extracts expiry dates from relevant documents and automatically sends notifications to the responsible consultants before the documents expire.

**PRODUCT REQUIREMENTS (New):**
1.  **Automatic Categorization on Upload:**
    *   **Backend:** Trigger the AI categorization service () immediately after a new document is successfully uploaded. The process should run in the background.

2.  **Expiry Date Extraction (AI):**
    *   **Backend ():** Modify the AI prompt to explicitly extract  (in  format) for document types like , , , , . It should return  for documents without an expiry date. Ensure the extracted date is stored as a valid  object or ISO string.

3.  **Expiry Date Persistence:**
    *   **Backend:** Add an  field and a  boolean field to the  collection schema in MongoDB. Ensure  is indexed.

4.  **Scheduled Watchdog Task:**
    *   **Backend (New service: ):**
        *   Create a daily scheduled job () to run at 09:00 AM.
        *   The job must query for documents where the  is within the next 60 days and  is not true.
        *   For each found document, identify the assigned consultant and create a system notification.
        *   Send an email alert to the responsible user.
        *   Update the  flag to prevent duplicate notifications.

5.  **Frontend Expiry Alerts:**
    *   **Frontend:**
        *   Display the notifications generated by the watchdog in the main notification bell icon ().
        *   On the client's Documents tab, display a warning icon next to any document that is nearing its expiry date, with colors corresponding to urgency levels (Yellow: 60-30 days, Orange: 29-7 days, Red: <7 days).

**User's preferred language**: Portuguese. The next agent MUST respond in Portuguese.

**what currently exists?**
The application is a process management CRM. The agent has just successfully implemented a new feature for **AI-powered document categorization and semantic search**. This feature allows users to manually trigger AI categorization for all documents in a process and then search through them using natural language. The feature was fully tested by the testing agent and is ready.

**Last working item**:
-   **Last item agent was working**: The agent received two new, high-priority tasks from the user after completing the AI search feature: 1. Make AI categorization automatic on upload. 2. Build a comprehensive Document Expiry Watchdog system. The agent acknowledged these new requirements and was about to begin implementation.
-   **Status**: NOT STARTED
-   **Agent Testing Done**: N/A
-   **Which testing method agent to use?**: both. The backend will require a new scheduled task and modifications to AI services. The frontend will require UI changes for alerts. A full run with the testing agent will be necessary after implementation.
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
-   None.

**In progress Task List**:
-   None.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **P0: Automatic AI Categorization on Upload:** Modify the document upload process to trigger the AI categorization service in the background automatically.
-   **P0: AI-Powered Document Expiry Watchdog (TAREFAS 1-4):** Implement the full feature as described in the Product Requirements, including AI extraction of expiry dates, a scheduled task to check for upcoming expirations, and frontend alerts.
    -   **TAREFA 1:** Enhance AI service to extract .
    -   **TAREFA 2:** Update MongoDB schema and persist the .
    -   **TAREFA 3:** Create the daily scheduled Watchdog job for notifications.
    -   **TAREFA 4:** Integrate alerts into the frontend UI.

**Future Tasks:**
-   P2: Replace offset-based pagination with cursor-based pagination.
-   P2: Refactor the large  file.
-   P2: Implement a Redis caching layer for frequently accessed data.

**Completed work in this session**
-   **Feature: AI Document Categorization and Search (DONE)**
    -   **Backend:**
        -   Created  to store categories and embeddings.
        -   Created  with logic to call Gemini for categorization.
        -   Added  method to .
        -   Added  and  endpoints to .
        -   Installed  dependency.
    -   **Frontend:**
        -   Created  for the UI.
        -   Integrated the new component into .
-   **Testing:** The feature was successfully validated via manual  tests, a frontend screenshot, and a full pass (100% success) from the .

**Earlier issues found/mentioned but not fixed**
-   None. The agent made a redundant improvement suggestion but quickly corrected itself after the user pointed it out. This was resolved within the session.

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork**:  dependency failure.
-   **Recurrence count**: 2+
-   **Status**: RESOLVED (Did not occur in this session).

**Code Architecture**


**Key Technical Concepts**
-   **AI-based Text Categorization**: Using an LLM (Gemini) to analyze document content and assign relevant categories.
-   **PDF Text Extraction**: Using the  library to extract text from PDF files for AI processing.
-   **API Development**: Creating new REST endpoints for triggering AI tasks and retrieving results.
-   **React Component Development**: Building a new, reusable React component for search functionality and integrating it into an existing page.

**key DB schema**
-   **** (New Collection):
    -   : ObjectId
    -   : ObjectId
    -   : string (e.g., Identification, Financial, Legal)
    -   : array[float] (for semantic search)

**changes in tech stack**
-   Added  to the backend dependencies.

**All files of reference**
-    (To be modified for expiry dates)
-    (Endpoint for upload needs modification)
-   
-   

**key api endpoints**
-   : (NEW) Triggers AI categorization for all documents in a process.
-   : (NEW) Performs a search across categorized documents.

**Critical Info for New Agent**
-   Your immediate priority is to implement the two user requests from message #104: **automatic categorization on upload** and the **expiry date watchdog system**.
-   The user has provided very detailed, technical requirements for the watchdog system (TAREFAS 1-4). Follow them closely.
-   The automatic categorization task is an enhancement of the feature just built. You should modify the existing document upload logic to call the new  asynchronously.
-   The user is technically savvy and noticed when the agent suggested a redundant feature. Be precise and ensure your suggestions are novel.

**documents and test reports created in this job**
-   : Validated the AI document categorization and search feature.
-   : Updated to reflect the completion of the AI search feature.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User #104 (Requirement):**  - The user approved the agent's suggestion for automatic categorization and provided a detailed list of new requirements for an AI Document Expiry Watchdog feature. **Status: Pending Implementation.**
2.  **User #100 (Feedback):**  - The user correctly pointed out that the agent's initial improvement suggestion (document expiry management) was already an existing feature. **Status: Resolved.**
3.  **User #5 (Confirmation):**  - The user provided specific requirements for the AI search feature, which the agent then implemented. **Status: Completed.**

**Project Health Check:**
-   **Broken**: No. The application is stable and the last feature was successfully tested.
-   **Mocked**: No.

**3rd Party Integrations**
-   AWS S3
-   OpenAI GPT-4o — uses Emergent LLM Key
-   Gemini (via ) — uses Emergent LLM Key
-    library

**Testing status**
-   **Testing agent used after significant changes**: YES. The testing agent successfully validated the AI search feature.
-   **Troubleshoot agent used after agent stuck in loop**: NO.
-   **Test files created**: No.
-   **Known regressions**: NO.

**Credentials to test flow:**
-   **Admin Email**: 
-   **Admin Password**: 
-   **Consultant Email**: 
-   **Consultant Password**: 

**What agent forgot to execute**
-   The agent initially made a redundant suggestion but corrected it upon user feedback. No core implementation tasks were missed in the last session. The new tasks from the user are the next items to be executed.</analysis>
